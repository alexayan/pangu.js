{"version":3,"sources":["webpack:///webpack/universalModuleDefinition","webpack:///webpack/bootstrap afd6337e91719ea41397","webpack:///./src/browser/pangu.js","webpack:///./src/shared/core.js"],"names":["Pangu","require","COMMENT_NODE_TYPE","BrowserPangu","topTags","ignoreTags","spaceSensitiveTags","spaceLikeTags","blockTags","node","parentNode","nodeName","search","isContentEditable","getAttribute","targetNode","childNodes","i","length","childNode","nodeType","textContent","xPathQuery","contextNode","textNodes","document","evaluate","XPathResult","ORDERED_NODE_SNAPSHOT_TYPE","currentTextNode","nextTextNode","snapshotLength","snapshotItem","canIgnoreNode","newText","spacing","data","nextSibling","testText","toString","substr","testNewText","nextNode","isFirstTextChild","currentNode","isLastTextChild","previousSibling","panguSpace","createElement","innerHTML","insertBefore","previousElementSibling","removeChild","spacingNodeByXPath","idName","className","tagName","tag","spacingPageTitle","spacingPageBody","pangu","exports","module","cjkQuote","quoteCJK","fixQuote","fixANSQuote","fixSingleQuote","hashANSCJKhash","cjkHash","hashCJK","cjkOperatorANS","ansOperatorCJK","cjkBracketCJK","cjkBracket","bracketCJK","fixBracket","fixSymbol","cjkANS","ansCJK","text","replace","test","oldText","tmpText","callback","err"],"mappings":"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","file":"pangu.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"pangu\", [], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"pangu\"] = factory();\n\telse\n\t\troot[\"pangu\"] = factory();\n})(this, function() {\nreturn \n\n\n/** WEBPACK FOOTER **\n ** webpack/universalModuleDefinition\n **/"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n/** WEBPACK FOOTER **\n ** webpack/bootstrap afd6337e91719ea41397\n **/","const Pangu = require('../shared/core').Pangu;\n\n// https://developer.mozilla.org/en/docs/Web/API/Node/nodeType\nconst COMMENT_NODE_TYPE = 8;\n\nclass BrowserPangu extends Pangu {\n\n  constructor() {\n    super();\n\n    this.topTags = /^(html|head|body|#document)$/i;\n    this.ignoreTags = /^(script|code|pre|textarea)$/i;\n    this.spaceSensitiveTags = /^(a|del|pre|s|strike|u)$/i;\n    this.spaceLikeTags = /^(br|hr|i|img|pangu)$/i;\n    this.blockTags = /^(div|h1|h2|h3|h4|h5|h6|p)$/i;\n\n    // TODO\n    // this.ignoreClasses\n    // this.ignoreAttributes\n  }\n\n  canIgnoreNode(node) {\n    let parentNode = node.parentNode;\n\n    while (parentNode && parentNode.nodeName && parentNode.nodeName.search(this.topTags) === -1) {\n      if ((parentNode.nodeName.search(this.ignoreTags) >= 0) || (parentNode.isContentEditable) || (parentNode.getAttribute('g_editable') === 'true')) {\n        return true;\n      }\n\n      parentNode = parentNode.parentNode;\n    }\n\n    return false;\n  }\n\n  isFirstTextChild(parentNode, targetNode) {\n    const childNodes = parentNode.childNodes;\n\n    // 只判斷第一個含有 text 的 node\n    for (let i = 0; i < childNodes.length; i++) {\n      const childNode = childNodes[i];\n      if (childNode.nodeType !== COMMENT_NODE_TYPE && childNode.textContent) {\n        return childNode === targetNode;\n      }\n    }\n\n    return false;\n  }\n\n  isLastTextChild(parentNode, targetNode) {\n    const childNodes = parentNode.childNodes;\n\n    // 只判斷倒數第一個含有 text 的 node\n    for (let i = childNodes.length - 1; i > -1; i--) {\n      const childNode = childNodes[i];\n      if (childNode.nodeType !== COMMENT_NODE_TYPE && childNode.textContent) {\n        return childNode === targetNode;\n      }\n    }\n\n    return false;\n  }\n\n  spacingNodeByXPath(xPathQuery, contextNode) {\n    // 因為 xPathQuery 會是用 text() 結尾，所以這些 nodes 會是 text 而不是 DOM element\n    // snapshotLength 要配合 XPathResult.ORDERED_NODE_SNAPSHOT_TYPE 使用\n    // https://developer.mozilla.org/en-US/docs/DOM/document.evaluate\n    // https://developer.mozilla.org/en-US/docs/Web/API/XPathResult\n    const textNodes = document.evaluate(xPathQuery, contextNode, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);\n\n    let currentTextNode;\n    let nextTextNode;\n\n    // 從最下面、最裡面的節點開始，所以是倒序的\n    for (let i = textNodes.snapshotLength - 1; i > -1; --i) {\n      currentTextNode = textNodes.snapshotItem(i);\n\n      if (this.canIgnoreNode(currentTextNode)) {\n        nextTextNode = currentTextNode;\n        continue;\n      }\n\n      const newText = this.spacing(currentTextNode.data);\n      if (currentTextNode.data !== newText) {\n        currentTextNode.data = newText;\n      }\n\n      // 處理嵌套的 <tag> 中的文字\n      if (nextTextNode) {\n        // TODO\n        // 現在只是簡單地判斷相鄰的下一個 node 是不是 <br>\n        // 萬一遇上嵌套的標籤就不行了\n        if (currentTextNode.nextSibling && currentTextNode.nextSibling.nodeName.search(this.spaceLikeTags) >= 0) {\n          nextTextNode = currentTextNode;\n          continue;\n        }\n\n        // currentTextNode 的最後一個字 + nextTextNode 的第一個字\n        const testText = currentTextNode.data.toString().substr(-1) + nextTextNode.data.toString().substr(0, 1);\n        const testNewText = this.spacing(testText);\n        if (testNewText !== testText) {\n          // 往上找 nextTextNode 的 parent node\n          // 直到遇到 spaceSensitiveTags\n          // 而且 nextTextNode 必須是第一個 text child\n          // 才能把空格加在 nextTextNode 的前面\n          let nextNode = nextTextNode;\n          while (nextNode.parentNode && nextNode.nodeName.search(this.spaceSensitiveTags) === -1 && this.isFirstTextChild(nextNode.parentNode, nextNode)) {\n            nextNode = nextNode.parentNode;\n          }\n\n          let currentNode = currentTextNode;\n          while (currentNode.parentNode && currentNode.nodeName.search(this.spaceSensitiveTags) === -1 && this.isLastTextChild(currentNode.parentNode, currentNode)) {\n            currentNode = currentNode.parentNode;\n          }\n\n          if (currentNode.nextSibling) {\n            if (currentNode.nextSibling.nodeName.search(this.spaceLikeTags) >= 0) {\n              nextTextNode = currentTextNode;\n              continue;\n            }\n          }\n\n          if (currentNode.nodeName.search(this.blockTags) === -1) {\n            if (nextNode.nodeName.search(this.spaceSensitiveTags) === -1) {\n              if ((nextNode.nodeName.search(this.ignoreTags) === -1) && (nextNode.nodeName.search(this.blockTags) === -1)) {\n                if (nextTextNode.previousSibling) {\n                  if (nextTextNode.previousSibling.nodeName.search(this.spaceLikeTags) === -1) {\n                    nextTextNode.data = ` ${nextTextNode.data}`;\n                  }\n                } else {\n                  // dirty hack\n                  if (!this.canIgnoreNode(nextTextNode)) {\n                    nextTextNode.data = ` ${nextTextNode.data}`;\n                  }\n                }\n              }\n            } else if (currentNode.nodeName.search(this.spaceSensitiveTags) === -1) {\n              currentTextNode.data = `${currentTextNode.data} `;\n            } else {\n              const panguSpace = document.createElement('pangu');\n              panguSpace.innerHTML = ' ';\n\n              // 避免一直被加空格\n              if (nextNode.previousSibling) {\n                if (nextNode.previousSibling.nodeName.search(this.spaceLikeTags) === -1) {\n                  nextNode.parentNode.insertBefore(panguSpace, nextNode);\n                }\n              } else {\n                nextNode.parentNode.insertBefore(panguSpace, nextNode);\n              }\n\n              // TODO\n              // 主要是想要避免在元素（通常都是 <li>）的開頭加空格\n              // 這個做法有點蠢，但是不管還是先硬上\n              if (!panguSpace.previousElementSibling) {\n                if (panguSpace.parentNode) {\n                  panguSpace.parentNode.removeChild(panguSpace);\n                }\n              }\n            }\n          }\n        }\n      }\n\n      nextTextNode = currentTextNode;\n    }\n  }\n\n  spacingNode(contextNode) {\n    const xPathQuery = './/*/text()[normalize-space(.)]';\n    this.spacingNodeByXPath(xPathQuery, contextNode);\n  }\n\n  spacingElementById(idName) {\n    const xPathQuery = `id(\"${idName}\")//text()`;\n    this.spacingNodeByXPath(xPathQuery, document);\n  }\n\n  spacingElementByClassName(className) {\n    const xPathQuery = `//*[contains(concat(\" \", normalize-space(@class), \" \"), \"${className}\")]//text()`;\n    this.spacingNodeByXPath(xPathQuery, document);\n  }\n\n  spacingElementByTagName(tagName) {\n    const xPathQuery = `//${tagName}//text()`;\n    this.spacingNodeByXPath(xPathQuery, document);\n  }\n\n  spacingPageTitle() {\n    const xPathQuery = '/html/head/title/text()';\n    this.spacingNodeByXPath(xPathQuery, document);\n  }\n\n  spacingPageBody() {\n    // // >> 任意位置的節點\n    // . >> 當前節點\n    // .. >> 父節點\n    // [] >> 條件\n    // text() >> 節點的文字內容，例如 hello 之於 <tag>hello</tag>\n    //\n    // [@contenteditable]\n    // 帶有 contenteditable 屬性的節點\n    //\n    // normalize-space(.)\n    // 當前節點的頭尾的空白字元都會被移除，大於兩個以上的空白字元會被置換成單一空白\n    // https://developer.mozilla.org/en-US/docs/XPath/Functions/normalize-space\n    //\n    // name(..)\n    // 父節點的名稱\n    // https://developer.mozilla.org/en-US/docs/XPath/Functions/name\n    //\n    // translate(string, \"ABCDEFGHIJKLMNOPQRSTUVWXYZ\", \"abcdefghijklmnopqrstuvwxyz\")\n    // 將 string 轉換成小寫，因為 XML 是 case-sensitive 的\n    // https://developer.mozilla.org/en-US/docs/XPath/Functions/translate\n    //\n    // 1. 處理 <title>\n    // 2. 處理 <body> 底下的節點\n    // 3. 略過 contentEditable 的節點\n    // 4. 略過特定節點，例如 <script> 和 <style>\n    //\n    // 注意，以下的 query 只會取出各節點的 text 內容！\n    let xPathQuery = '/html/body//*/text()[normalize-space(.)]';\n    for (const tag of ['script', 'style', 'textarea']) {\n      // 理論上這幾個 tag 裡面不會包含其他 tag\n      // 所以可以直接用 .. 取父節點\n      // ex: [translate(name(..), \"ABCDEFGHIJKLMNOPQRSTUVWXYZ\", \"abcdefghijklmnopqrstuvwxyz\") != \"script\"]\n      xPathQuery += `[translate(name(..),\"ABCDEFGHIJKLMNOPQRSTUVWXYZ\",\"abcdefghijklmnopqrstuvwxyz\")!=\"${tag}\"]`;\n    }\n    this.spacingNodeByXPath(xPathQuery, document);\n  }\n\n  // TODO: 支援 callback 和 promise\n  spacingPage() {\n    this.spacingPageTitle();\n    this.spacingPageBody();\n  }\n\n}\n\nconst pangu = new BrowserPangu();\n\nexports = module.exports = pangu;\nexports.Pangu = BrowserPangu;\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/browser/pangu.js\n **/","// CJK is short for Chinese, Japanese and Korean.\n//\n// The constant cjk contains following Unicode blocks:\n// \t\\u2e80-\\u2eff CJK Radicals Supplement\n// \t\\u2f00-\\u2fdf Kangxi Radicals\n// \t\\u3040-\\u309f Hiragana\n// \t\\u30a0-\\u30ff Katakana\n// \t\\u3100-\\u312f Bopomofo\n// \t\\u3200-\\u32ff Enclosed CJK Letters and Months\n// \t\\u3400-\\u4dbf CJK Unified Ideographs Extension A\n// \t\\u4e00-\\u9fff CJK Unified Ideographs\n// \t\\uf900-\\ufaff CJK Compatibility Ideographs\n//\n// For more information about Unicode blocks, see\n// \thttp://unicode-table.com/en/\n//  https://github.com/vinta/pangu\n\n// ANS is short for Alphabets, Numbers and Symbols (`~!@#$%^&*()-_=+[]{}\\|;:'\",<.>/?).\n//\n// CAUTION: those ANS in following constants do not contain all symbols above.\n\n// cjkQuote >> 跟 Go 版差了一個 '\n// quoteCJK >> 跟 Go 版差了一個 '\nconst cjkQuote = /([\\u2e80-\\u2eff\\u2f00-\\u2fdf\\u3040-\\u309f\\u30a0-\\u30ff\\u3100-\\u312f\\u3200-\\u32ff\\u3400-\\u4dbf\\u4e00-\\u9fff\\uf900-\\ufaff])([\"])/g;\nconst quoteCJK = /([\"])([\\u2e80-\\u2eff\\u2f00-\\u2fdf\\u3040-\\u309f\\u30a0-\\u30ff\\u3100-\\u312f\\u3200-\\u32ff\\u3400-\\u4dbf\\u4e00-\\u9fff\\uf900-\\ufaff])/g;\nconst fixQuote = /([\"']+)(\\s*)(.+?)(\\s*)([\"']+)/g;\nconst fixANSQuote = /([\"]+)(\\s*)(.+?)(\\s*)([\"]+)/g;\nconst fixSingleQuote = /([\\u2e80-\\u2eff\\u2f00-\\u2fdf\\u3040-\\u309f\\u30a0-\\u30ff\\u3100-\\u312f\\u3200-\\u32ff\\u3400-\\u4dbf\\u4e00-\\u9fff\\uf900-\\ufaff])( )(')([A-Za-z])/g;\n\nconst hashANSCJKhash = /([\\u2e80-\\u2eff\\u2f00-\\u2fdf\\u3040-\\u309f\\u30a0-\\u30ff\\u3100-\\u312f\\u3200-\\u32ff\\u3400-\\u4dbf\\u4e00-\\u9fff\\uf900-\\ufaff])(#)([A-Za-z0-9\\u2e80-\\u2eff\\u2f00-\\u2fdf\\u3040-\\u309f\\u30a0-\\u30ff\\u3100-\\u312f\\u3200-\\u32ff\\u3400-\\u4dbf\\u4e00-\\u9fff\\uf900-\\ufaff]+)(#)([\\u2e80-\\u2eff\\u2f00-\\u2fdf\\u3040-\\u309f\\u30a0-\\u30ff\\u3100-\\u312f\\u3200-\\u32ff\\u3400-\\u4dbf\\u4e00-\\u9fff\\uf900-\\ufaff])/g;\nconst cjkHash = /([\\u2e80-\\u2eff\\u2f00-\\u2fdf\\u3040-\\u309f\\u30a0-\\u30ff\\u3100-\\u312f\\u3200-\\u32ff\\u3400-\\u4dbf\\u4e00-\\u9fff\\uf900-\\ufaff])(#([^ ]))/g;\nconst hashCJK = /(([^ ])#)([\\u2e80-\\u2eff\\u2f00-\\u2fdf\\u3040-\\u309f\\u30a0-\\u30ff\\u3100-\\u312f\\u3200-\\u32ff\\u3400-\\u4dbf\\u4e00-\\u9fff\\uf900-\\ufaff])/g;\n\nconst cjkOperatorANS = /([\\u2e80-\\u2eff\\u2f00-\\u2fdf\\u3040-\\u309f\\u30a0-\\u30ff\\u3100-\\u312f\\u3200-\\u32ff\\u3400-\\u4dbf\\u4e00-\\u9fff\\uf900-\\ufaff])([\\+\\-\\*\\/=\\\\|<>])([A-Za-z0-9])/g;\nconst ansOperatorCJK = /([A-Za-z0-9])([\\+\\-\\*\\/=&\\\\|<>])([\\u2e80-\\u2eff\\u2f00-\\u2fdf\\u3040-\\u309f\\u30a0-\\u30ff\\u3100-\\u312f\\u3200-\\u32ff\\u3400-\\u4dbf\\u4e00-\\u9fff\\uf900-\\ufaff])/g;\n\nconst cjkBracketCJK = /([\\u2e80-\\u2eff\\u2f00-\\u2fdf\\u3040-\\u309f\\u30a0-\\u30ff\\u3100-\\u312f\\u3200-\\u32ff\\u3400-\\u4dbf\\u4e00-\\u9fff\\uf900-\\ufaff])([\\(\\[\\{<\\u201c]+(.*?)[\\)\\]\\}>\\u201d]+)([\\u2e80-\\u2eff\\u2f00-\\u2fdf\\u3040-\\u309f\\u30a0-\\u30ff\\u3100-\\u312f\\u3200-\\u32ff\\u3400-\\u4dbf\\u4e00-\\u9fff\\uf900-\\ufaff])/g;\nconst cjkBracket = /([\\u2e80-\\u2eff\\u2f00-\\u2fdf\\u3040-\\u309f\\u30a0-\\u30ff\\u3100-\\u312f\\u3200-\\u32ff\\u3400-\\u4dbf\\u4e00-\\u9fff\\uf900-\\ufaff])([\\(\\[\\{<\\u201c>])/g;\nconst bracketCJK = /([\\)\\]\\}>\\u201d<])([\\u2e80-\\u2eff\\u2f00-\\u2fdf\\u3040-\\u309f\\u30a0-\\u30ff\\u3100-\\u312f\\u3200-\\u32ff\\u3400-\\u4dbf\\u4e00-\\u9fff\\uf900-\\ufaff])/g;\nconst fixBracket = /([\\(\\[\\{<\\u201c]+)(\\s*)(.+?)(\\s*)([\\)\\]\\}>\\u201d]+)/;\n\nconst fixSymbol = /([\\u2e80-\\u2eff\\u2f00-\\u2fdf\\u3040-\\u309f\\u30a0-\\u30ff\\u3100-\\u312f\\u3200-\\u32ff\\u3400-\\u4dbf\\u4e00-\\u9fff\\uf900-\\ufaff])([~!;:,\\.\\?\\u2026])([A-Za-z0-9])/g;\n\nconst cjkANS = /([\\u2e80-\\u2eff\\u2f00-\\u2fdf\\u3040-\\u309f\\u30a0-\\u30ff\\u3100-\\u312f\\u3200-\\u32ff\\u3400-\\u4dbf\\u4e00-\\u9fff\\uf900-\\ufaff])([A-Za-z0-9`\\$%\\^&\\*\\-=\\+\\\\\\|/@\\u00a1-\\u00ff\\u2022\\u2027\\u2150-\\u218f])/g;\nconst ansCJK = /([A-Za-z0-9`~\\$%\\^&\\*\\-=\\+\\\\\\|/!;:,\\.\\?\\u00a1-\\u00ff\\u2022\\u2026\\u2027\\u2150-\\u218f])([\\u2e80-\\u2eff\\u2f00-\\u2fdf\\u3040-\\u309f\\u30a0-\\u30ff\\u3100-\\u312f\\u3200-\\u32ff\\u3400-\\u4dbf\\u4e00-\\u9fff\\uf900-\\ufaff])/g;\n\nclass Pangu {\n\n  spacing(text) {\n    let newText = text;\n\n    newText = newText.replace(cjkQuote, '$1 $2');\n    newText = newText.replace(quoteCJK, '$1 $2');\n    if (/^[^\\u2e80-\\u2eff\\u2f00-\\u2fdf\\u3040-\\u309f\\u30a0-\\u30ff\\u3100-\\u312f\\u3200-\\u32ff\\u3400-\\u4dbf\\u4e00-\\u9fff\\uf900-\\ufaff]+$/.test(newText)) {\n      newText = newText.replace(fixANSQuote, '$1$3$5');\n    } else {\n      newText = newText.replace(fixQuote, '$1$3$5');\n    }\n    newText = newText.replace(fixSingleQuote, '$1$3$4');\n\n    newText = newText.replace(hashANSCJKhash, '$1 $2$3$4 $5');\n    newText = newText.replace(cjkHash, '$1 $2');\n    newText = newText.replace(hashCJK, '$1 $3');\n\n    newText = newText.replace(cjkOperatorANS, '$1 $2 $3');\n    newText = newText.replace(ansOperatorCJK, '$1 $2 $3');\n\n    const oldText = newText;\n    const tmpText = newText.replace(cjkBracketCJK, '$1 $2 $4');\n    newText = tmpText;\n    if (oldText === tmpText) {\n      newText = newText.replace(cjkBracket, '$1 $2');\n      newText = newText.replace(bracketCJK, '$1 $2');\n    }\n    newText = newText.replace(fixBracket, '$1$3$5');\n\n    newText = newText.replace(fixSymbol, '$1$2 $3');\n\n    newText = newText.replace(cjkANS, '$1 $2');\n    newText = newText.replace(ansCJK, '$1 $2');\n\n    return newText;\n  }\n\n  spacingText(text, callback = () => {}) {\n    try {\n      const newText = this.spacing(text);\n      callback(null, newText);\n    } catch (err) {\n      callback(err);\n    }\n  }\n\n}\n\nconst pangu = new Pangu();\n\nexports = module.exports = pangu;\nexports.Pangu = Pangu;\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/shared/core.js\n **/"],"sourceRoot":""}